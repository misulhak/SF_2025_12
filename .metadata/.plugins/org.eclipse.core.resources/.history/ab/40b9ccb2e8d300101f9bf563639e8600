package org.zerock.service;

import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.zerock.dto.TodoDTO;

import lombok.extern.log4j.Log4j2;

@ExtendWith(SpringExtension.class)
@ContextConfiguration("file:src/main/webapp/WEB-INF/spring/root-context.xml")
@Log4j2
class TodoServiceTests {

	@Autowired
	private TodoService todoService; 
	
	@Test
	void testList() {
        log.info("--- 테스트: 목록 조회 ---");
		todoService.getList() 
		    .forEach(todo -> log.info(todo));
	}
	
	@Test
	void testOne() {
        log.info("--- 테스트: 개별 조회 (ID 1) ---");
		TodoDTO dto = todoService.getTodoById(1); 
		
		log.info(dto);
        assertNotNull(dto);
	}
	
	@Test
	void testInsert() {
        log.info("--- 테스트: 등록 ---");
		TodoDTO dto = TodoDTO.builder()
				.title("서비스 테스트 등록")
				.description("서비스 계층에서 테스트로 추가하는 항목입니다.")
				.build();
		
		todoService.insert(dto); 
        
        assertNotNull(dto.getId()); 
        log.info("등록된 Todo ID: " + dto.getId());
	}
	
	@Test
	void testUpdate() {
        log.info("--- 테스트: 수정 (ID 10) ---");
		TodoDTO dto = TodoDTO.builder()
				.id(10) 
				.title("서비스에서 수정한 제목")
				.description("서비스에서 수정한 설명입니다.")
				.done(true) 
				.build();
		
		todoService.update(dto);

        TodoDTO updatedDto = todoService.getTodoById(10);
		log.info("수정 후 데이터: " + updatedDto);
        assertTrue(updatedDto.isDone());
	}
	
	@Test
	void testDelete() {
        log.info("--- 테스트: 삭제 (ID 3) ---");
		todoService.delete(3); 

        assertNull(todoService.getTodoById(3));
	}

}